parameters:
  environment: ''
  location: ''
  serviceConnection: ''
  stack: ''
  project: ''
  tfversion: ''
  tfInitSub: ''
  builtFrom: ''
  product: ''
  action: ''

steps:

  - script: rm -fr .terraform/modules/genesis

  - template: steps/set-build-repo-suffix-env-var.yaml@cnp-azuredevops-libraries           
  - template: steps/terraform.yaml@cnp-azuredevops-libraries
    parameters:
      overrideAction: ${{ parameters.action }}
      environment: ${{ parameters.environment }}
      component: "00-genesis"
      serviceConnection: ${{ variables.serviceConnection }}
      terraformInitSubscription: ${{ variables.tfInitSub }}
      product: ${{ variables.product }}
      terraformVarFile: "$(System.DefaultWorkingDirectory)/$(buildRepoSuffix)/environments/00-genesis/${{ parameters.environment }}.tfvars"
      planCommandOptions: "-var project=${{ variables.project }} -var subscription_id=$(ARM_SUBSCRIPTION_ID) -var environment=${{ parameters.environment }}"

